% We can think of coloring diagrams with a chosen palette $(R, M, \mathcal{C}_\pm)$ as being a {\color{red}functor from a set of diagrams to a set of matrices}.
\hl{Coloring diagrams with a chosen palette $(R, M, \mathcal{C}_\pm)$ is a functor from the category of knot diagrams, whose objects are diagrams and morphisms represent Reidemeister moves, to a category of matrices, with morphisms corresponding to matrix equivalence explained in this section.}

\hl{Moreover, if a palette $P=(R, M, \mathcal{C}_\pm)$ is given alongside a ring homomorphism $f:R\to S$, then an image of this palette $P$ through induced palette homomorphism is $(S, M\otimes_R S, \mathcal{C}_\pm\otimes_R S)$. Similarly, if an $R$-module homomorphism $g:M\to N$ is given, then the image of palette $P$ is $(R, N, g(\mathcal{C}_\pm))$.}

\begin{definition}[color checking matrix]\label{def:color checking matrix}
  Assigning segments of diagram $D$ to coordinates in $M^s$ and crossings to coordinates in $N_\pm^x$ it is possible to define a linear homomorphism $D\phi:M^s\to N_\pm^x$  as
  $$D\phi(m_1,...,m_s)=(\phi_\pm(\pi_{x_1}(m_1,...,m_s)), \phi_\pm(\pi_{x_2}(m_1,...,m_s)),...).$$
  Matrix that is created after choosing a basis for $M^s$ and $N_\pm^x$ will be called a \buff{color checking matrix}.
\end{definition}

\begin{proposition}
  Coloring $(m_1,...,m_s)\in M^s$ is admissible $\iff$ $(m_1,...,m_s)\in\ker D\phi$.
\end{proposition}

\begin{proof}
  We start by saying that 
  $$(m_1,..., m_s)\in\ker D\phi\iff [(\forall\;x_j\text{ crossing})\;\phi_\pm(\pi_{x_j}(m_1,..., m_s))=0].$$
  Which is to say that every coordinate of $D\phi(m_1,..., m_s)$ is zero. Proposition \cref{proposition male kernel kolorowania} says that it is equivalent with $(m_1,..., m_s)$ being an admissible coloring.
\end{proof}

We want to define which color checking matrices are equivalent. We will say that $D\phi$ and $D'\phi$ are equivalent if 
\begin{enumerate}
  \item they differ by a permutation of rows or columns, 
  \item one can be obtained from the other by adding a linear combination of rows or columns to another row or columns 
  \item one can be obtained from the other by adding a new row and a new column with only $0$ save for the term on their intersection, which is a unit.
\end{enumerate}
The first two points mean that two color checking matrices $D\phi, D'\phi:M^s\to N^x$ are equivalent if there exist an isomorphisms $\theta:M^s\to M^s$ and $\psi:N^x\to N^x$ such that
$$
\begin{tikzcd}[column sep=large]
  M^s\arrow[r, "D\phi"]\arrow[d, "\theta" left] & N^x\arrow[d, "\psi" right]\\ 
  M^s\arrow[r, "D'\phi" below] & N^x
\end{tikzcd}
$$
is a commutative diagram. 

In the most basic sense, two diagrams $D$ and $D'$ are isomorphic if there exists an isotopy $h_t:\R^2\to \R^2$ such that $h_0(D)=D$ and $h_1(D)=D'$ and $D'$ has crossings identical to those of $D$.

\begin{lemma}
  Isomorphic diagrams $D\sim D'$ yield equivalent color checking matrices $D\phi\sim D'\phi$.
\end{lemma}

\begin{proof}
  In terms of color checking matrices, an isomorphism of diagrams defined above only relabels segments (permutes columns) and crossings (permutes rows).
\end{proof}

In reality, the isomorphism between diagrams which relates diagrams of the same knot is much more subtle. This relation $R$ is generated by the Reidemeister moves (see \cref{reidemeister-generating}). There is an induced relation on the set of color checking matrices, called $D(R)$, that relates color checking matrices of the same knot. 
\hl{For suitably chosen palettes, an invariant of the equivalent class of matrices of the same knot is known.} 

\begin{definition}[Alexander palette]
One of such palettes is the \buff{Alexander palette} {\boldmath$(R=\Z[\Z], M=\Z[\Z], \mathcal{C}_\pm)$}, where $\mathcal{C}_\pm$ are defined by homomorphisms
$$\phi_+(u,i,o)=(1-t)u+ti-o$$
$$\phi_-(u,i,o)=(1-t^{-1})u+t^{-1}i-o,$$
with $u$, $i$ and $o$ defined in \cref{crossing_type}. 
\end{definition}

For the Alexander palette said invariant is e.g. the determinant of a \hl{$n-1$ minor of the color checking matrix up to multiplication by a unit}. 


The following example illustrates the importance of choosing a suitable palette.

\begin{example}
  Consider a coloring of trefoil knot $3_1$ with two palettes: $P_1=(\Z, \Z, \phi_\pm(u,i,o)=2u-i+o)$ that is not an image of the Alexander palette and $P_2=(\Z, \Z, \phi_\pm(u,i,o)=2u-i-o)$ which in turn is one. The color checking matrix of its diagram with $3$ crossings is
  \begin{center}
    \begin{tikzpicture}
      \begin{knot}[
        consider self intersections, 
        clip width = 20pt, 
        % draft mode=crossings, 
        flip crossing=2
        ] 
        \strand[->, thick] (90:2) to[out=0, in=-60, looseness=2]
        (210:2) to[out=120, in=60, looseness=2]
        (-30:2) to[out=-120, in=180, looseness=2] 
        (90:2);
      \end{knot}

      \node[anchor=west] at (3, 1.8) {
        $P_1(D)=
        \begin{bmatrix}
          2 & -1 & 1\\ 
          -1 & 1 & 2 \\ 
          1 & 2 & -1 
        \end{bmatrix}\mapsto \{1, -3, -5\} 
      $};

    \node[anchor=west] (p2) at (3, -1.2) {
        $P_2(D)=
        \begin{bmatrix}
          2 & -1 & -1\\ 
          -1 & -1 & 2 \\ 
          -1 & 2 & -1 
        \end{bmatrix}\mapsto\{-3\}
      $};
    \end{tikzpicture}
  \end{center}

  while after the first Reidemeister move, the color checking matrix is

  \begin{center}
    \begin{tikzpicture}
      \begin{knot}[
        consider self intersections, 
        clip width = 20pt,
        %ignore endpoint intersections=false,
        % draft mode=crossings,
        % flip crossin=1,
        % flip crossing=2
        ] 
        \strand[<-, thick] (80:3) to[out=-100, in=30] 
        (90:2) to[out=-30, in=-60, looseness=2]
        (210:2) to[out=120, in=60, looseness=2]
        (-30:2) to[out=-120, in=210, looseness=2] 
        (90:2) to[out=150, in=-80] 
        (100:3) to[out=100, in=80, looseness=2] 
        (80:3);
      \end{knot}
      \fill[white] (90:2) circle (10pt);
      \draw[thick] ($(90:2)+({0.3*cos(210)}, {0.3*sin(210)})+(-0.02, -0.07)$) to[out=30, in=-120] ($(90:2) + ({0.3*cos(30}, {0.3*sin(30})+(0, 0.08)$);%(80:3);
      % \draw[->, thin] (90:2) to[out=-30, in=-60, loosenes=2] (210:2);
      
      \node[anchor=west] at (3, 2.5) {$P_1(D)=
          \begin{bmatrix}
            0 & 2 & 1 & -1 \\ 
            0 & -1 & 2 & 1 \\ 
            1 & 0 & -1 & 2\\ 
            1 & 1 & 0 & 0
          \end{bmatrix}\mapsto\{5, 11, 3, ...\}$
        };
      
      \node[anchor=west] at (3, -1) {$P_2(D)=
          \begin{bmatrix}
            0 & 2 & -1 & -1 \\ 
            0 & -1 & 2 & -1 \\ 
            -1 & 0 & -1 & 2\\ 
            -1 & -1 & 0 & 0
          \end{bmatrix}\mapsto\{-3, 3\}$
        };
    \end{tikzpicture}
  \end{center}
\end{example}

In order to ensure that the equivalence classes of color checking matrices under the relation induced by Reidemeister moves on diagrams have a known invariant, rules must be imposed on palettes. A particular set of palettes that will satisfy conditions to be mention are the Alexander palette and all palettes derived from it by either a ring homomorphism or a module homomorphism.

The coloring rule modules $\mathcal{C}_\pm$ are to be isomorphic to $M^2$, with the red arrow being an isomorphism
    $$
    \begin{tikzcd}
      M^2 \arrow[r, hookrightarrow] \arrow[rr, bend right=25, red, "\cong" below] & M^3 \arrow[twoheadrightarrow, r] & \mathcal{C}_\pm.
    \end{tikzcd}
    $$
    We want the red isomorphism to be $(u, i)\mapsto (u, i, \phi_\pm'(u, i))\in\mathcal{C}_\pm$, with segments labeled like in \cref{crossing_type}, meaning that $c$ and $\gamma$ in \eqref{phi equations1} and \eqref{phi equations2} respectively are units. For the sake of convenience, take $c=\gamma=-1$.

    This property of palettes will be called a \buff{propagation rule} as knowing colors of two of the three segments allows one to calculate the color assigned to the remaining segment.

    \begin{lemma}\label{warunki na palete}
  A palette that meets the propagation rule has the following two properties determined by Reidemeister moves.
  \begin{enumerate}
    \item The first Reidemeister move requires that
      $$a=1-b$$
      $$\alpha=1-\beta,$$
      where the variables are coefficients from \eqref{phi equations1} and \eqref{phi equations2}.  
    \item Similarly, the second Reidemeister move requires
      $$\begin{cases}
        a\beta+\alpha=0\\ 
        \beta b=1.
      \end{cases}$$
  \end{enumerate}
\end{lemma}

% {\color{red}from now on we want to work with palettes that satisfy the following conditions: dwuwymiaroowe C i propagation rule, to a = 1-b, b beta = 1 oraz a beta + alpha = 0. in particular, we want to work with the Alexander palette and all palettes derived from it}







