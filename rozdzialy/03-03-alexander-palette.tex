%In reality, the equivalence between diagrams which relates diagrams of the same knot is much more subtle than the isomorphism from the previous section. This relation $R$ is generated by the Reidemeister moves (see \cref{reidemeister-generating}). There is an induced relation on the set of color checking matrices, called $D(R)$, that relates color checking matrices of the same knot. 
%\hl{For suitably chosen palettes, an invariant of the equivalent class of matrices of the same knot is known.} 

In this section we will define a palette for which the assigment $D\mapsto D\phi$ yields a knot invariant.

Consider a crossing
\begin{center}
  \begin{tikzpicture}
    \draw[<-] (0, 0) node[above] {$o$} --(2, 0) node[above] {$i$};
    \fill[white](1, 0) circle (7pt);
    \draw[->] (1, -1) node[right] {$u$}--(1, 1);
  \end{tikzpicture}
\end{center}
and take some $x$ to be the generator in the Wirtinger presentation of the knot group that is used to generate a representation for $K_G^{ab}$ (see \cref{alexander module discussion}). Then, the following is a relation in said group
$$UxCx(Ux)^{-1}=Ix$$
where $U=ux^{-1}$, $I=ix^{-1}$ and $O=ox^{-1}$. 
We can multiply both sides by $x^{-1}$ to obtain
$$x^{-1}UxCU^{-1}=x^{-1}Ix$$
which is change in $\Z[\Z]$ to
$$
tU+C-U=tI\implies 0=(1-t)U+tI-C
$$
The procedure for the other type of crossing is analogous and yields relation $0=(1-t^{-1})U+t^{-1}I-C$.

\begin{definition}[Alexander palette]
A palette {\boldmath$(R=\Z[\Z], M=\Z[\Z], \mathcal{C}_\pm)$}, where $\mathcal{C}_\pm$ are defined by homomorphisms
$$\phi_+(u,i,o)=(1-t)u+ti-o$$
$$\phi_-(u,i,o)=(1-t^{-1})u+t^{-1}i-o,$$
with $u$, $i$ and $o$ defined in \cref{crossing_type}, is called the \buff{Alexander palette}.
\end{definition}


% Thus, the equivalence class of color checking matrices of a knot whose diagrams are being colored with the Alexander palette will be the same as for the Alexander matrix. Thus, the determinant up to multiplication of a unit of a minor of the color checking matrix will be a knot invariant.


The following example illustrates the importance of choosing a suitable palette.

\begin{example}\label{ex1}
  Consider a coloring of trefoil knot $3_1$ with two palettes: $P_1=(\Z, \Z, \phi_\pm(u,i,o)=2u-i+o)$ that is not an image of the Alexander palette and $P_2=(\Z, \Z, \phi_\pm(u,i,o)=2u-i-o)$ which in turn is one (by $\Z[\Z]\ni t\mapsto -1\in\Z$). On the diagram below the color checking matrices of the diagram with $3$ crossings along with example $2\times 2$ minor values (on the right of the matrix) of it are presented
  \begin{center}
    \begin{tikzpicture}
      \begin{knot}[
        consider self intersections, 
        clip width = 20pt, 
        % draft mode=crossings, 
        flip crossing=2
        ] 
        \strand[->, thick] (90:2) to[out=0, in=-60, looseness=2]
        (210:2) to[out=120, in=60, looseness=2]
        (-30:2) to[out=-120, in=180, looseness=2] 
        (90:2);
      \end{knot}

      \begin{scope}[shift={(7, 1.8)}]
      \matrix (m) [
        matrix of nodes, 
        left delimiter = {[}, 
        right delimiter={]},
        column sep=5mm
      ]
        {
                2  & -1 & 1  \\
                -1 & 1  & 2  \\
                1  & 2  & -1 \\
        };
           
      \draw[red, thick, dashed] (m-1-1.north west) rectangle (m-2-2.south east);
      \node at ($(m-1-1)!0.5!(m-1-2)+(0, .7)$) {$\color{red}1$};

      \draw[green, thick, dashed] (m-2-2.north west) rectangle (m-3-3.south east);
      \node at ($(m-3-2)!0.5!(m-3-3)+(0, -0.7)$) {$\color{green}-5$};
        \node at ($(m-2-1.west)+(-1.8, 0)$) {$P_1(D)=$};
      \end{scope}
      
      \begin{scope}[shift={(7, -1.8)}]
        \matrix (m) [
          matrix of nodes, 
          left delimiter = {[}, 
          right delimiter={]},
          column sep=5mm
        ]
          {
                  2  & -1 & -1  \\
                  -1 & -1  & 2  \\
                  -1  & 2  & -1 \\
          };
             
        \draw[red, thick, dashed] (m-1-1.north west) rectangle (m-2-2.south east);
        \node at ($(m-1-1)!0.5!(m-1-2)+(0, .7)$) {$\color{red}-3$};

        \draw[green, thick, dashed] (m-2-2.north west) rectangle (m-3-3.south east);
        \node at ($(m-3-2)!0.5!(m-3-3)+(0, -0.7)$) {$\color{green}-3$};
        \node at ($(m-2-1.west)+(-1.8, 0)$) {$P_2(D)=$};
      \end{scope}
      % \begin{scope}[shift={(7, 2.5)}]
      %   \matrix (m) [
      %     matrix of nodes, 
      %     left delimiter = {[}, 
      %     right delimiter={]},
      %     column sep=5mm
      %   ]
      %     {
      %       0  & 2 & 1 & -1  \\
      %       0  & -1 & 2  & 1  \\
      %       1  & 0  & -1  & 2 \\
      %       1 & 1 & 0 & 0 \\
      %     };
      %
      %   \draw[red, thick, dashed] (m-1-1.north west) rectangle (m-3-3.south east);
      %   \node at ($(m-1-1)!0.5!(m-1-3)+(0, .7)$) {$\color{red}5$};
      %
      %   \draw[green, thick, dashed] (m-2-2.north west) rectangle (m-4-4.south east);
      %   \node at ($(m-4-2)!0.5!(m-4-4)+(0, -0.7)$) {$\color{green}5$};
      %
      %   \draw[blue, thick, dashed] ($(m-1-2.north west)+(-0.01, 0.1)$) rectangle ($(m-3-4.south east)+(0.1, 0.1)$);
      %   \node at ($(m-1-2)!0.5!(m-1-4)+(0, 0.7)$) {$\color{blue}11$};
      %
      %   \node at ($(m-2-1.west)+(-1.8, 0)$) {$P_1(D)=$};
      % \end{scope}

    \end{tikzpicture}
  \end{center}

  while after the first Reidemeister move, the color checking matrices and their $3\times 3$ minors are

  \begin{center}
    \begin{tikzpicture}
      \begin{knot}[
        consider self intersections, 
        clip width = 20pt,
        %ignore endpoint intersections=false,
        % draft mode=crossings,
        % flip crossin=1,
        % flip crossing=2
        ] 
        \strand[<-, thick] (80:3) to[out=-100, in=30] 
        (90:2) to[out=-30, in=-60, looseness=2]
        (210:2) to[out=120, in=60, looseness=2]
        (-30:2) to[out=-120, in=210, looseness=2] 
        (90:2) to[out=150, in=-80] 
        (100:3) to[out=100, in=80, looseness=2] 
        (80:3);
      \end{knot}
      \fill[white] (90:2) circle (10pt);
      \draw[thick] ($(90:2)+({0.3*cos(210)}, {0.3*sin(210)})+(-0.02, -0.07)$) to[out=30, in=-120] ($(90:2) + ({0.3*cos(30}, {0.3*sin(30})+(0, 0.08)$);%(80:3);
      % \draw[->, thin] (90:2) to[out=-30, in=-60, loosenes=2] (210:2);
      

    
      \begin{scope}[shift={(7, 2.5)}]
        \matrix (m) [
          matrix of nodes, 
          left delimiter = {[}, 
          right delimiter={]},
          column sep=5mm
        ]
          {
            0  & 2 & 1 & -1  \\
            0  & -1 & 2  & 1  \\
            1  & 0  & -1  & 2 \\
            1 & 1 & 0 & 0 \\
          };
             
        \draw[red, thick, dashed] (m-1-1.north west) rectangle (m-3-3.south east);
        \node at ($(m-1-1)!0.5!(m-1-3)+(0, .7)$) {$\color{red}5$};

        \draw[green, thick, dashed] (m-2-2.north west) rectangle (m-4-4.south east);
        \node at ($(m-4-2)!0.5!(m-4-4)+(0, -0.7)$) {$\color{green}5$};
        
        \draw[blue, thick, dashed] ($(m-1-2.north west)+(-0.01, 0.1)$) rectangle ($(m-3-4.south east)+(0.1, 0.1)$);
        \node at ($(m-1-2)!0.5!(m-1-4)+(0, 0.7)$) {$\color{blue}11$};

        \node at ($(m-2-1.west)+(-1.8, 0)$) {$P_1(D)=$};
      \end{scope}
      
      \begin{scope}[shift={(7, -1.5)}]
        \matrix (m) [
          matrix of nodes, 
          left delimiter = {[}, 
          right delimiter={]},
          column sep=5mm
        ]
          {
            0  & 2 & -1 & -1  \\
            0  & -1 & 2  & -1  \\
            -1  & 0  & -1  & 2 \\
            1 & -1 & 0 & 0 \\
          };
             
        \draw[red, thick, dashed] (m-1-1.north west) rectangle (m-3-3.south east);
        \node at ($(m-1-1)!0.5!(m-1-3)+(0, .7)$) {$\color{red}-3$};

        \draw[green, thick, dashed] (m-2-2.north west) rectangle (m-4-4.south east);
        \node at ($(m-4-2)!0.5!(m-4-4)+(0, -0.7)$) {$\color{green}-3$};
        
        \draw[blue, thick, dashed] ($(m-1-2.north west)+(-0.01, 0.1)$) rectangle ($(m-3-4.south east)+(0.1, 0.1)$);
        \node at ($(m-1-2)!0.5!(m-1-4)+(0, 0.7)$) {$\color{blue}3$};

        \node at ($(m-2-1.west)+(-1.8, 0)$) {$P_1(D)=$};
      \end{scope}

      % \node[anchor=west] at (3, 2.5) {$P_1(D)=
      %     \begin{bmatrix}
      %       0 & 2 & 1 & -1 \\ 
      %       0 & -1 & 2 & 1 \\ 
      %       1 & 0 & -1 & 2\\ 
      %       1 & 1 & 0 & 0 \\
      %     \end{bmatrix}\mapsto\{5, 11, 3, ...\}$
      %   };
      
     
      % \node[anchor=west] at (3, -1) {$P_2(D)=
      %     \begin{bmatrix}
      %       0 & 2 & -1 & -1 \\ 
      %       0 & -1 & 2 & -1 \\ 
      %       -1 & 0 & -1 & 2\\ 
      %       1 & -1 & 0 & 0
      %     \end{bmatrix}\mapsto\{-3, 3\}$
      %   };
    \end{tikzpicture}
  \end{center}
  
  For the Alexander palette $P_2$, the minors are the same in both diagrams, while for the palette $P_1$ there is no apparent relation between the minors.
\end{example}

% In order to ensure that the equivalence classes of color checking matrices under the relation induced by Reidemeister moves on diagrams have a known invariant, rules must be imposed on palettes. A particular set of palettes that will satisfy conditions to be mention are the Alexander palette and all palettes derived from it by either a ring homomorphism or a module homomorphism.

%For any palette for which $D\mapsto D\phi$ is a functor, in particular the Alexander palette, 

In both palettes from the \cref{ex1} coloring rule modules $\mathcal{C}_\pm$ are isomorphic to $M^2$ like in the diagram:
    $$
    \begin{tikzcd}[row sep=tiny]
      M^3 \arrow[r, twoheadrightarrow, yshift=.7ex] \arrow[r, hookleftarrow, yshift=-.7ex] & M^2 \arrow[r, red, "\cong", leftrightarrow] & \mathcal{C}_\pm\\ 
      (u,i,o) & (u, i) & (u, i, \phi_\pm'(u,i))
      % M^2 \arrow[r, hookrightarrow] \arrow[rr, bend right=25, red, "\cong" below] & M^3 \arrow[twoheadrightarrow, r] & \mathcal{C}_\pm.
    \end{tikzcd}
    $$
The red isomorphism $(u, i)\mapsto (u, i, \phi_\pm'(u, i))\in\mathcal{C}_\pm$, with segments labeled like in \cref{crossing_type}, means that $c$ and $\gamma$ in \eqref{phi equations1} and \eqref{phi equations2} respectively are units. For the sake of convenience, take $c=\gamma=-1$.

    This property of palettes will be called a \buff{propagation rule} as knowing colors of two of the three segments allows one to calculate the color assigned to the remaining segment.

    \begin{lemma}\label{warunki na palete}
  %A palette that meets the propagation rule has the following two properties determined by Reidemeister moves.
  If a palette has the propagation rule and the following two properties:
  \begin{enumerate}
    \item $a=1-b$ and $\alpha=1-\beta$
    \item $b$ and $\beta$ are mutual inverses ($b\beta=1$) and $\alpha\beta+\alpha=0$
  \end{enumerate}
  % \begin{enumerate}
  %   \item The first Reidemeister move requires that
  %     $$a=1-b$$
  %     $$\alpha=1-\beta,$$
  %     where the variables are coefficients from \eqref{phi equations1} and \eqref{phi equations2}.  
  %   \item Similarly, the second Reidemeister move requires
  %     $$\begin{cases}
  %       a\beta+\alpha=0\\ 
  %       \beta b=1.
  %     \end{cases}$$
  % \end{enumerate}
    then Reidemeister equivalent diagrams yiled equivalent matrices under the relation presented in the next section.
\end{lemma}

Proof of the lemma is divided into two parts, each given in the next session after defining the relevant relation induced by the Reidemeister moves on color checking matrices.
